= Functions REST API


[[_overview]]
== Overview

// This file is created automatically by Swagger2Markup.
// DO NOT EDIT!

The Admin REST API is a secondary API provided by the Query service.
This API enables you to manage the JavaScript libraries and objects that are used to create N1QL user-defined functions.

The API schemes and host URLs are as follows:{blank}

* `+http://node:8093/+`
* `+https://node:18093/+` (for secure access)

where [.var]`node` is the host name or IP address of a computer running the N1QL query engine.


=== Version information
[%hardbreaks]
__Version__ : 1.0


=== Consumes

* `application/json`


=== Produces

* `application/json`




[[_paths]]
== Paths

:page-partial:

:name: \{name}
:cluster: \{cluster}
:node: \{node}
:request: \{request}
:stat: \{stat}

// Dummy attributes for path parameters


[[_get_collection]]
=== Read All Libraries
....
GET /functions/v1/libraries
....


==== Description
Returns all libraries and functions.


==== Responses

[options="header", cols=".^2a,.^14a,.^4a"]
|===
|HTTP Code|Description|Schema
|**200**|An array of objects, each of which gives information about one library.|< <<_libraries,Libraries>> > array
|===


==== Security

[options="header", cols=".^3a,.^4a"]
|===
|Type|Name
|**basic**|**<<_default,Default>>**
|===


==== Example HTTP response

===== Response 200
[source,json]
----
[ {
  "name" : "math",
  "functions" : [ {
    "name" : "adder",
    "code" : "function adder(a, b) { return a + b; } function helper() { return; }"
  }, {
    "name" : "multiplier",
    "code" : "function multiplier(a, b) { return a * b; } function helper() { return; }"
  } ]
}, {
  "name" : "science",
  "functions" : [ {
    "name" : "f2c",
    "code" : "function f2c(f) { return (5/9)*(f-32); }"
  } ]
} ]
----


[[_put_collection]]
=== Replace All Libraries
....
PUT /functions/v1/libraries
....


==== Description
This has exactly the same effect as <<_delete_collection,deleting all libraries>> followed by <<_post_collection,creating a collection of libraries>>.
That is, all existing libraries in the system are deleted, and the libraries specified in the body of this call are created, resulting in the system having exclusively the libraries specified by this call.


==== Parameters

[options="header", cols=".^2a,.^3a,.^9a,.^4a"]
|===
|Type|Name|Description|Schema
|**Body**|**Collection** +
__required__|An array of objects, each of which gives information about one library.|<<_collection,Collection>>
|===


==== Responses

[options="header", cols=".^2a,.^14a,.^4a"]
|===
|HTTP Code|Description|Schema
|**200**|The operation was successful.|No Content
|**500**|Internal server error.
The body of the request may be incorrect.|No Content
|===


==== Security

[options="header", cols=".^3a,.^4a"]
|===
|Type|Name
|**basic**|**<<_default,Default>>**
|===


==== Example HTTP request

===== Request body
[source,json]
----
[ {
  "name" : "math",
  "functions" : [ {
    "name" : "adder",
    "code" : "function adder(a, b) { return a + b; } function helper() { return; }"
  }, {
    "name" : "multiplier",
    "code" : "function multiplier(a, b) { return a * b; } function helper() { return; }"
  } ]
}, {
  "name" : "science",
  "functions" : [ {
    "name" : "f2c",
    "code" : "function f2c(f) { return (5/9)*(f-32); }"
  } ]
} ]
----


[[_post_collection]]
=== Create or Update a Collection of Libraries
....
POST /functions/v1/libraries
....


==== Description
Creates the specified libraries and their associated functions.
If any specified library exists, the functions specified in the body for that library are appended to the existing library.
If any specified function exists within an existing library, the existing function is overwritten.


==== Parameters

[options="header", cols=".^2a,.^3a,.^9a,.^4a"]
|===
|Type|Name|Description|Schema
|**Body**|**Collection** +
__required__|An array of objects, each of which gives information about one library.|<<_collection,Collection>>
|===


==== Responses

[options="header", cols=".^2a,.^14a,.^4a"]
|===
|HTTP Code|Description|Schema
|**200**|The operation was successful.|No Content
|**500**|Internal server error.
The body of the request may be incorrect.|No Content
|===


==== Security

[options="header", cols=".^3a,.^4a"]
|===
|Type|Name
|**basic**|**<<_default,Default>>**
|===


==== Example HTTP request

===== Request body
[source,json]
----
[ {
  "name" : "math",
  "functions" : [ {
    "name" : "adder",
    "code" : "function adder(a, b) { return a + b; } function helper() { return; }"
  }, {
    "name" : "multiplier",
    "code" : "function multiplier(a, b) { return a * b; } function helper() { return; }"
  } ]
}, {
  "name" : "science",
  "functions" : [ {
    "name" : "f2c",
    "code" : "function f2c(f) { return (5/9)*(f-32); }"
  } ]
} ]
----


[[_delete_collection]]
=== Delete All Libraries
....
DELETE /functions/v1/libraries
....


==== Description
Deletes all libraries entirely.


==== Responses

[options="header", cols=".^2a,.^14a,.^4a"]
|===
|HTTP Code|Description|Schema
|**200**|The operation was successful.|No Content
|===


==== Security

[options="header", cols=".^3a,.^4a"]
|===
|Type|Name
|**basic**|**<<_default,Default>>**
|===


[[_get_library]]
=== Read a Library
....
GET /functions/v1/libraries/{library}
....


==== Description
Returns a library with all its functions.


==== Parameters

[options="header", cols=".^2a,.^3a,.^9a,.^4a"]
|===
|Type|Name|Description|Schema
|**Path**|**library** +
__required__|The name of a library.|string
|===


==== Responses

[options="header", cols=".^2a,.^14a,.^4a"]
|===
|HTTP Code|Description|Schema
|**200**|An object giving information about the specified library.|<<_libraries,Libraries>>
|**404**|Not found.
The library name in the path may be incorrect.|No Content
|===


==== Security

[options="header", cols=".^3a,.^4a"]
|===
|Type|Name
|**basic**|**<<_default,Default>>**
|===


==== Example HTTP response

===== Response 200
[source,json]
----
{
  "name" : "math",
  "functions" : [ {
    "name" : "add",
    "code" : "function add(a, b) { let data = a + b; return data; }"
  }, {
    "name" : "sub",
    "code" : "function sub(a, b) { let data = a - b; return data; }"
  }, {
    "name" : "mul",
    "code" : "function mul(a, b) { let data = a * b; return data; }"
  } ]
}
----


[[_put_library]]
=== Replace a Library
....
PUT /functions/v1/libraries/{library}
....


==== Description
This has exactly the same effect as <<_delete_library,deleting a library>> followed by <<_post_library,creating a library>>.
That is, if the library exists, it is deleted entirely and replaced with the contents of the library specified in the body of this call, resulting in the library having only functions specified by this call exclusively.


==== Parameters

[options="header", cols=".^2a,.^3a,.^9a,.^4a"]
|===
|Type|Name|Description|Schema
|**Path**|**library** +
__required__|The name of a library.|string
|**Body**|**Libraries** +
__required__|An object specifying a library.|<<_libraries,Libraries>>
|===


==== Responses

[options="header", cols=".^2a,.^14a,.^4a"]
|===
|HTTP Code|Description|Schema
|**200**|The operation was successful.|No Content
|**400**|Bad request.
The library name in the path may not match the name in the body of the request.|No Content
|**500**|Internal server error.
The body of the request may be incorrect.|No Content
|===


==== Security

[options="header", cols=".^3a,.^4a"]
|===
|Type|Name
|**basic**|**<<_default,Default>>**
|===


==== Example HTTP request

===== Request body
[source,json]
----
{
  "name" : "math",
  "functions" : [ {
    "name" : "adder",
    "code" : "function adder(a, b) { return a + b; } function helper() { return; }"
  }, {
    "name" : "multiplier",
    "code" : "function multiplier(a, b) { return a * b; } function helper() { return; }"
  } ]
}
----


[[_post_library]]
=== Create or Update a Library
....
POST /functions/v1/libraries/{library}
....


==== Description
Creates the specified library and its associated functions.
If the specified library exists, the functions specified are added to the existing library.
If a specified function exists within the existing library, the existing function is overwritten.


==== Parameters

[options="header", cols=".^2a,.^3a,.^9a,.^4a"]
|===
|Type|Name|Description|Schema
|**Path**|**library** +
__required__|The name of a library.|string
|**Body**|**Libraries** +
__required__|An object specifying a library.|<<_libraries,Libraries>>
|===


==== Responses

[options="header", cols=".^2a,.^14a,.^4a"]
|===
|HTTP Code|Description|Schema
|**200**|The operation was successful.|No Content
|**400**|Bad request.
The library name in the path may not match the name in the body of the request.|No Content
|**500**|Internal server error.
The body of the request may be incorrect.|No Content
|===


==== Security

[options="header", cols=".^3a,.^4a"]
|===
|Type|Name
|**basic**|**<<_default,Default>>**
|===


==== Example HTTP request

===== Request body
[source,json]
----
{
  "name" : "math",
  "functions" : [ {
    "name" : "adder",
    "code" : "function adder(a, b) { return a + b; } function helper() { return; }"
  }, {
    "name" : "multiplier",
    "code" : "function multiplier(a, b) { return a * b; } function helper() { return; }"
  } ]
}
----


[[_delete_library]]
=== Delete a Library
....
DELETE /functions/v1/libraries/{library}
....


==== Description
Deletes the specified library entirely.


==== Parameters

[options="header", cols=".^2a,.^3a,.^9a,.^4a"]
|===
|Type|Name|Description|Schema
|**Path**|**library** +
__required__|The name of a library.|string
|===


==== Responses

[options="header", cols=".^2a,.^14a,.^4a"]
|===
|HTTP Code|Description|Schema
|**200**|The operation was successful.|No Content
|**404**|Not found.
The library name in the path may be incorrect.|No Content
|===


==== Security

[options="header", cols=".^3a,.^4a"]
|===
|Type|Name
|**basic**|**<<_default,Default>>**
|===


[[_get_function]]
=== Read a Function
....
GET /functions/v1/libraries/{library}/functions/{function}
....


==== Description
Returns the specified function from the specified library.


==== Parameters

[options="header", cols=".^2a,.^3a,.^9a,.^4a"]
|===
|Type|Name|Description|Schema
|**Path**|**function** +
__required__|The name of a function.|string
|**Path**|**library** +
__required__|The name of a library.|string
|===


==== Responses

[options="header", cols=".^2a,.^14a,.^4a"]
|===
|HTTP Code|Description|Schema
|**200**|An object giving information about the specified function.|<<_functions,Functions>>
|**404**|Not found.
The library name or function name in the path may be incorrect.|No Content
|===


==== Security

[options="header", cols=".^3a,.^4a"]
|===
|Type|Name
|**basic**|**<<_default,Default>>**
|===


==== Example HTTP response

===== Response 200
[source,json]
----
{
  "name" : "sub",
  "code" : "function sub(a,b) { return helper(a,b); }"
}
----


[[_put_function]]
=== Replace a Function
....
PUT /functions/v1/libraries/{library}/functions/{function}
....


==== Description
This has exactly the same effect as <<_post_function,creating or updating a function>>, and is included for completeness.


==== Parameters

[options="header", cols=".^2a,.^3a,.^9a,.^4a"]
|===
|Type|Name|Description|Schema
|**Path**|**function** +
__required__|The name of a function.|string
|**Path**|**library** +
__required__|The name of a library.|string
|**Body**|**Functions** +
__required__|An object specifying a function.|<<_functions,Functions>>
|===


==== Responses

[options="header", cols=".^2a,.^14a,.^4a"]
|===
|HTTP Code|Description|Schema
|**200**|The operation was successful.|No Content
|**400**|Bad request.
The library name or function name in the path may not match the name in the body of the request.|No Content
|**500**|Internal server error.
The body of the request may be incorrect.|No Content
|===


==== Security

[options="header", cols=".^3a,.^4a"]
|===
|Type|Name
|**basic**|**<<_default,Default>>**
|===


==== Example HTTP request

===== Request body
[source,json]
----
{
  "name" : "sub",
  "code" : "function sub(a,b) { return helper(a,b); } function helper(a,b) { return a - b; }"
}
----


[[_post_function]]
=== Create or Update a Function
....
POST /functions/v1/libraries/{library}/functions/{function}
....


==== Description
Creates the specified function in the specified library.
If the specified library does not exist, it is created.
If the function already exists in the specified library, it is overwritten.
[NOTE]
====
Within the function object, the name property must be the same as the name of the JavaScript function within the code property that returns the required result.
If it is not, you will get unexpected errors when you execute any N1QL user-defined function based on this code.
====


==== Parameters

[options="header", cols=".^2a,.^3a,.^9a,.^4a"]
|===
|Type|Name|Description|Schema
|**Path**|**function** +
__required__|The name of a function.|string
|**Path**|**library** +
__required__|The name of a library.|string
|**Body**|**Functions** +
__required__|An object specifying a function.|<<_functions,Functions>>
|===


==== Responses

[options="header", cols=".^2a,.^14a,.^4a"]
|===
|HTTP Code|Description|Schema
|**200**|The operation was successful.|No Content
|**400**|Bad request.
The library name or function name in the path may not match the name in the body of the request.|No Content
|**500**|Internal server error.
The body of the request may be incorrect.|No Content
|===


==== Security

[options="header", cols=".^3a,.^4a"]
|===
|Type|Name
|**basic**|**<<_default,Default>>**
|===


==== Example HTTP request

===== Request body
[source,json]
----
{
  "name" : "sub",
  "code" : "function sub(a,b) { return helper(a,b); } function helper(a,b) { return a - b; }"
}
----


[[_delete_function]]
=== Delete a Function
....
DELETE /functions/v1/libraries/{library}/functions/{function}
....


==== Description
Deletes the specified function in the specified library.


==== Parameters

[options="header", cols=".^2a,.^3a,.^9a,.^4a"]
|===
|Type|Name|Description|Schema
|**Path**|**function** +
__required__|The name of a function.|string
|**Path**|**library** +
__required__|The name of a library.|string
|===


==== Responses

[options="header", cols=".^2a,.^14a,.^4a"]
|===
|HTTP Code|Description|Schema
|**200**|The operation was successful.|No Content
|**404**|Not found.
The library name or function name in the path may be incorrect.|No Content
|===


==== Security

[options="header", cols=".^3a,.^4a"]
|===
|Type|Name
|**basic**|**<<_default,Default>>**
|===




[[_definitions]]
== Definitions

// Pass through HTML table styles for this page.
// This overrides Swagger2Markup's table layout defaults.

ifdef::basebackend-html[]
++++
<style type="text/css">
  /* No maximum width for table cells */
  .doc table.spread > tbody > tr > *,
  .doc table.stretch > tbody > tr > * {
    max-width: none !important;
  }

  /* Ignore fixed column widths */
  col{
    width: auto !important;
  }

  /* Do not hyphenate words in the table */
  td.tableblock p,
  p.tableblock{
    hyphens: manual !important;
  }

  /* Vertical alignment */
  td.tableblock{
    vertical-align: top !important;
  }
</style>
++++
endif::[]


[[_collection]]
=== Collection
__Type__ : < <<_libraries,Libraries>> > array


[[_libraries]]
=== Libraries

[options="header", cols=".^3a,.^11a,.^4a"]
|===
|Name|Description|Schema
|**functions** +
__required__|An array of objects, each of which gives information about one function. +
**Example** : `[ {
  "name" : "f2c",
  "code" : "function f2c(f) { return (5/9)*(f-32); }"
} ]`|< <<_functions,Functions>> > array
|**name** +
__required__|The name of the library. +
**Example** : `"science"`|string
|===


[[_functions]]
=== Functions

[options="header", cols=".^3a,.^11a,.^4a"]
|===
|Name|Description|Schema
|**code** +
__required__|The JavaScript code for the function. +
**Example** : `"function f2c(f) { return (5/9)*(f-32); }"`|string
|**id** +
__optional__|A unique ID for the function.
You do not need to specify an ID when creating or updating a function.
An ID is generated automatically if you do not specify one. +
**Example** : `"c4:1a:39:46:46:88:ff:3d"`|string
|**name** +
__required__|The name of the function. +
**Example** : `"f2c"`|string
|===




[[_securityscheme]]
== Security

[[_default]]
=== Default
The Functions API supports admin credentials.
Credentials can be passed via HTTP headers (HTTP basic authentication).

[%hardbreaks]
__Type__ : basic



