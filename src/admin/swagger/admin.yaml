swagger: '2.0'
info:
  title: Admin REST API
  version: '7.2'
  description: |
    The Admin REST API is a secondary API provided by the Query service.
    This API enables you to retrieve statistics about the clusters and nodes running the Query service; view or specify node-level settings; and view or delete requests.

    The API schemes and host URLs are as follows:{blank}

    * `+http://node:8093/+`
    * `+https://node:18093/+` (for secure access)

    where [.var]`node` is the host name or IP address of a computer running the Query service.

produces:
  - application/json

consumes:
  - application/x-www-form-urlencoded
  - application/json

tags:
  - name: configuration
    description: Operations for cluster and node configuration.
  - name: prepared statements
    description: Operations for prepared statements.
  - name: active requests
    description: Operations for active requests.
  - name: completed requests
    description: Operations for completed requests.
  - name: statistics
    description: Operations for query statistics.
  - name: settings
    description: Operations for query settings.
  - name: default
    description: Other operations.

paths:
  /admin/clusters:
    get:
      operationId: get_clusters
      summary: Read All Clusters
      description: Returns information about all clusters.
      tags:
        - configuration
      security:
        - Default: []
      responses:
        200:
          description: An array of objects, each of which gives information about one cluster.
          schema:
            type: array
            items:
              $ref: "#/definitions/Clusters"

  /admin/clusters/{cluster}:
    get:
      operationId: get_cluster
      summary: Read a Cluster
      parameters:
        - $ref: "#/parameters/PathCluster"
      description: Returns information about the specified cluster.
      tags:
        - configuration
      security:
        - Default: []
      responses:
        200:
          description: An object giving information about the specified cluster.
          schema:
            $ref: "#/definitions/Clusters"

  /admin/clusters/{cluster}/nodes:
    get:
      operationId: get_nodes
      summary: Read All Nodes
      parameters:
        - $ref: "#/parameters/PathCluster"
      description: Returns information about all nodes in the specified cluster.
      tags:
        - configuration
      security:
        - Default: []
      responses:
        200:
          description: An array of objects, each of which gives information about one node.
          schema:
            type: array
            items:
              $ref: "#/definitions/Nodes"

  /admin/clusters/{cluster}/nodes/{node}:
    get:
      operationId: get_node
      summary: Read a Node
      parameters:
        - $ref: "#/parameters/PathCluster"
        - $ref: "#/parameters/PathNode"
      description: Returns information about the specified node in the specified cluster.
      tags:
        - configuration
      security:
        - Default: []
      responses:
        200:
          description: An object giving information about the specified node.
          schema:
            $ref: "#/definitions/Nodes"

  /admin/config:
    get:
      operationId: get_config
      summary: Read Configuration
      description: Returns the configuration of the query service on the cluster.
      tags:
        - configuration
      security:
        - Default: []
      responses:
        200:
          description: An object giving information about the specified node.
          schema:
            $ref: "#/definitions/Nodes"

  /admin/prepareds:
    get:
      operationId: get_prepareds
      summary: Retrieve All Prepared Statements
      description: |
        Returns all prepared statements.
        [NOTE]
        ====
        Refer to xref:manage:monitor/monitoring-n1ql-query.adoc#sys-prepared-get[Get Prepared Statements] for examples.
        ====
      tags:
        - prepared statements
      security:
        - Default: []
      responses:
        200:
          description: An array of objects, each of which contains information about one prepared statement.
          schema:
            type: array
            items:
              $ref: "#/definitions/Statements"

  /admin/prepareds/{name}:
    get:
      operationId: get_prepared
      summary: Retrieve a Prepared Statement
      parameters:
        - $ref: "#/parameters/PathName"
      description: |
        Returns the specified prepared statement.
        [NOTE]
        ====
        Refer to xref:manage:monitor/monitoring-n1ql-query.adoc#sys-prepared-get[Get Prepared Statements] for examples.
        ====
      tags:
        - prepared statements
      security:
        - Default: []
      responses:
        200:
          description: An object containing information about the specified prepared statement.
          schema:
            $ref: "#/definitions/Statements"
    delete:
      operationId: delete_prepared
      summary: Delete a Prepared Statement
      parameters:
        - $ref: "#/parameters/PathName"
      description: |
        Deletes the specified prepared statement.
        [NOTE]
        ====
        Refer to xref:manage:monitor/monitoring-n1ql-query.adoc#sys-prepared-delete[Delete Prepared Statements] for examples.
        ====
      tags:
        - prepared statements
      security:
        - Default: []
      responses:
        200:
          description: True if the prepared statement was successfully deleted.
          schema:
            type: boolean
        500:
          description: Returns an error message if the prepared statement could not be found.
          schema:
            type: object

  /admin/active_requests:
    get:
      operationId: get_active_requests
      summary: Retrieve All Active Requests
      description: |
        Returns all active query requests.
        [NOTE]
        ====
        Refer to xref:manage:monitor/monitoring-n1ql-query.adoc#sys-active-get[Get Active Requests] for examples.
        ====
      tags:
        - active requests
      security:
        - Default: []
      responses:
        200:
          description: An array of objects, each of which contains information about one active request.
          schema:
            type: array
            items:
              $ref: "#/definitions/Requests"

  /admin/active_requests/{request}:
    get:
      operationId: get_active_request
      summary: Retrieve an Active Request
      parameters:
        - $ref: "#/parameters/PathRequest"
      description: |
        Returns the specified active query request.
        [NOTE]
        ====
        Refer to xref:manage:monitor/monitoring-n1ql-query.adoc#sys-active-get[Get Active Requests] for examples.
        ====
      tags:
        - active requests
      security:
        - Default: []
      responses:
        200:
          description: An object containing information about the specified active request.
          schema:
            $ref: "#/definitions/Requests"
    delete:
      operationId: delete_active_request
      summary: Delete an Active Request
      parameters:
        - $ref: "#/parameters/PathRequest"
      description: |
        Terminates the specified active query request.
        [NOTE]
        ====
        Refer to xref:manage:monitor/monitoring-n1ql-query.adoc#sys-active-delete[Terminate an Active Request] for examples.
        ====
      tags:
        - active requests
      security:
        - Default: []
      responses:
        200:
          description: True if the active request was successfully terminated.
          schema:
            type: boolean
        500:
          description: Returns an error message if the active request could not be found.
          schema:
            type: object

  /admin/completed_requests:
    get:
      operationId: get_completed_requests
      summary: Retrieve All Completed Requests
      description: |
        Returns all completed requests.
        [NOTE]
        ====
        Refer to xref:manage:monitor/monitoring-n1ql-query.adoc#sys-completed-get[Get Completed Requests] for examples.
        ====
      tags:
        - completed requests
      security:
        - Default: []
      responses:
        200:
          description: An array of objects, each of which contains information about one completed request.
          schema:
            type: array
            items:
              $ref: "#/definitions/Requests"

  /admin/completed_requests/{request}:
    get:
      operationId: get_completed_request
      summary: Retrieve a Completed Request
      parameters:
        - $ref: "#/parameters/PathRequest"
      description: |
        Returns the specified completed request.
        [NOTE]
        ====
        Refer to xref:manage:monitor/monitoring-n1ql-query.adoc#sys-completed-get[Get Completed Requests] for examples.
        ====
      tags:
        - completed requests
      security:
        - Default: []
      responses:
        200:
          description: An object containing information about the specified active request.
          schema:
            $ref: "#/definitions/Requests"
    delete:
      operationId: delete_completed_request
      summary: Delete a Completed Request
      parameters:
        - $ref: "#/parameters/PathRequest"
      description: |
        Purges the specified completed request.
        [NOTE]
        ====
        Refer to xref:manage:monitor/monitoring-n1ql-query.adoc#sys-completed-delete[Purge the Completed Requests] for examples.
        ====
      tags:
        - completed requests
      security:
        - Default: []
      responses:
        200:
          description: True if the completed request was successfully purged.
          schema:
            type: boolean
        500:
          description: Returns an error message if the completed request could not be found.
          schema:
            type: object

  /admin/indexes/prepareds:
    get:
      operationId: get_prepared_indexes
      summary: Retrieve Prepared Index Statements
      description: |
        Returns all prepared index statements.
        [TIP]
        ====
        * Use <<_get_prepared>> to get information about a prepared index statement.
        * Use <<_delete_prepared>> to delete a prepared index statement.
        ====
      tags:
        - prepared statements
      security:
        - Default: []
      responses:
        200:
          description: An array of strings, each of which is the name of a prepared index statement.
          schema:
            type: array
            items:
              type: string
              description: |
                The name of the prepared statement.
                This may be a UUID that was assigned automatically, or a name that was user-specified when the statement was created.

  /admin/indexes/active_requests:
    get:
      operationId: get_active_indexes
      summary: Retrieve Active Index Requests
      description: |
        Returns all active index requests.
        [TIP]
        ====
        * Use <<_get_active_request>> to get information about an active index request.
        * Use <<_delete_active_request>> to terminate an active index request.
        ====
      tags:
        - active requests
      security:
        - Default: []
      responses:
        200:
          description: An array of strings, each of which is the requestID of an active index request.
          schema:
            type: array
            items:
              type: string
              description: Unique request ID internally generated for the query.

  /admin/indexes/completed_requests:
    get:
      operationId: get_completed_indexes
      summary: Retrieve Completed Index Requests
      description: |
        Returns all completed index requests.
        [TIP]
        ====
        * Use <<_get_completed_request>> to get information about a completed index request.
        * Use <<_delete_completed_request>> to purge a completed index request.
        ====
      tags:
        - completed requests
      security:
        - Default: []
      responses:
        200:
          description: An array of strings, each of which is the requestID of a completed index request.
          schema:
            type: array
            items:
              type: string
              description: Unique request ID internally generated for the query.

  /admin/ping:
    get:
      operationId: get_ping
      summary: Ping
      description: Returns a minimal response, indicating that the service is running and reachable.
      tags:
        - default
      security:
        - None: []
      responses:
        200:
          description: An empty object.
          schema:
            type: object

  # /admin/ssl_cert:
  #   get:
  #     deprecated: true

  /admin/vitals:
    get:
      operationId: get_vitals
      summary: Retrieve Vitals
      description: |
        Returns data about the running state and health of the query engine.
        This information can be very useful to assess the current workload and performance characteristics of a query engine, and hence load-balance the requests being sent to various query engines.
        [NOTE]
        ====
        Refer to xref:manage:monitor/monitoring-n1ql-query.adoc#vitals[Get System Vitals] for examples.
        ====
      tags:
        - statistics
      security:
        - Default: []
      responses:
        200:
          description: An object containing all vital statistics.
          schema:
            $ref: "#/definitions/Vitals"

  /admin/stats:
    get:
      operationId: get_stats
      summary: Retrieve All Statistics
      description: Returns all statistics.
      tags:
        - statistics
      security:
        - Default: []
      responses:
        200:
          description: |
            An object containing all statistics.
            Each statistic consists of a top-level statistic name and a metric name.
            Each statistic has a different set of metrics.
          schema:
            $ref: "#/definitions/Statistics"

  /admin/stats/{stat}:
    get:
      operationId: get_stat
      summary: Retrieve a Statistic
      parameters:
        - $ref: "#/parameters/PathStat"
      description: Returns the specified statistic.
      tags:
        - statistics
      security:
        - Default: []
      responses:
        200:
          description: |
            An object containing all metrics for the specified statistic.
            Each statistic has a different set of metrics.
          schema:
            $ref: "#/definitions/Metrics"

  /debug/vars:
    get:
      operationId: get_debug_vars
      summary: Get Debug Variables
      description: Currently unused.
      tags:
        - statistics
      security:
        - None: []
      produces:
        - text/html
      responses:
        302:
          description: Redirects to the <<_get_stats>> endpoint.
          schema:
            type: text/html

  /admin/settings:
    get:
      operationId: get_settings
      summary: Retrieve Node-Level Query Settings
      description: |
        Returns node-level query settings.
        [NOTE]
        ====
        Refer to xref:settings:query-settings.adoc[Query Settings] for more information.
        ====
      tags:
        - settings
      security:
        - Default: []
      responses:
        200:
          description: An object giving node-level query settings.
          schema:
            $ref: "#/definitions/Settings"
    post:
      operationId: post_settings
      summary: Update Node-Level Query Settings
      description: |
        Updates node-level query settings.
        [NOTE]
        ====
        Refer to xref:settings:query-settings.adoc[Query Settings] for more information.
        ====
      tags:
        - settings
      security:
        - Default: []
      parameters:
        - in: body
          name: Settings
          description: An object specifying node-level query settings.
          schema:
            $ref: "#/definitions/Settings"
      responses:
        200:
          description: An object giving node-level query settings, including the latest changes.
          schema:
            $ref: "#/definitions/Settings"

definitions:
  Clusters:
    type: object
    title: Cluster Information
    properties:
      name:
        type: string
        description: The name of the cluster.
      datastore:
        type: string
        description: The URL of the datastore.
      configstore:
        type: string
        description: The URL of the configstore.
      accountstore:
        type: string
        description: The URL of the accountstore.
      version:
        type: string

  Nodes:
    type: object
    title: Node Information
    properties:
      cluster:
        type: string
        description: The name of the cluster.
      name:
        type: string
        description: The URL of the node, including port number.
      queryEndpoint:
        type: string
        description: The HTTP URL of the query endpoint.
      adminEndpoint:
        type: string
        description: The HTTP URL of the admin endpoint.
      querySecure:
        type: string
        description: The HTTPS URL of the query endpoint.
      adminSecure:
        type: string
        description: The HTTPS URL of the admin endpoint.
      options:
        type: string

  Requests:
    type: object
    title: Requests
    properties:
      clientContextID:
        type: string
        description: |
          The opaque ID or context provided by the client.
          Refer to the {client_context_id}[request-level] `client_context_id` parameter for more information.
      elapsedTime:
        type: string
        format: duration
        description: |
          The time taken from when the request was acknowledged by the service to when the request was completed.
          It includes the time taken by the service to schedule the request.
      errorCount:
        type: integer
        description: Total number of errors encountered while executing the query.
      memoryQuota:
        type: integer
        description: |
          The memory quota for the request, in MB.
          This property is only returned if a memory quota is set for the query.
      node:
        type: string
        description: IP address and port number of the node where the query is executed.
      phaseCounts:
        type: object
        description: |
          Count of documents processed at selective phases involved in the query execution.
          Refer to xref:manage:monitor/monitoring-n1ql-query.adoc#profile[Attribute Profile in Query Response] for more details and examples.
      phaseOperators:
        type: object
        description: |
          Indicates the number of each kind of query operators involved in different phases of the query processing.
          Refer to xref:manage:monitor/monitoring-n1ql-query.adoc#profile[Attribute Profile in Query Response] for more details and examples.
      phaseTimes:
        type: object
        description: |
          Cumulative execution times for various phases involved in the query execution.
          Refer to xref:manage:monitor/monitoring-n1ql-query.adoc#profile[Attribute Profile in Query Response] for more details and examples.
      remoteAddr:
        type: string
        description: IP address and port number of the client application, from where the query is received.
      requestId:
        type: string
        format: uuid
        description: Unique request ID internally generated for the query.
      requestTime:
        type: string
        format: date-time
        description: Timestamp when the query is received.
      resultCount:
        type: integer
        description: Total number of documents returned in the query result.
      resultSize:
        type: integer
        description: Total number of bytes returned in the query result.
      scanConsistency:
        type: string
        description: The value of the query setting Scan Consistency used for the query.
      serviceTime:
        type: string
        format: duration
        description: Total amount of calendar time taken to complete the query.
      state:
        type: string
        description: |
          The state of the query execution, such as `completed`, `running`, `cancelled`.

          Note that the `completed` state means that the request was started and completed by the Query service, but it does not mean that it was necessarily successful.
          The request could have been successful, or completed with errors.

          To find requests that were successful, use this field in conjunction with the `errorCount` field: search for requests whose state is `completed` and whose error count is `0`.
      statement:
        type: string
        description: The query statement being executed.
      useCBO:
        type: boolean
        description: Whether the cost-based optimizer is enabled for the query.
      usedMemory:
        type: integer
        description: |
          The amount of document memory used to execute the request.
          This property is only returned if a memory quota is set for the query.
      userAgent:
        type: string
        description: Name of the client application or program that issued the query.
      users:
        type: string
        description: Username with whose privileges the query is run.

  Statements:
    type: object
    title: Prepared Statements
    required:
      - encoded_plan
      - name
      - statement
      - uses
    properties:
      encoded_plan:
        type: string
        description: The full prepared statement in encoded format.
      featureControls:
        type: integer
        description: |
          This property is provided for technical support only.
          It is only returned when retrieving a specific prepared statement, not when retrieving all prepared statements.
      indexApiVersion:
        type: integer
        description: |
          This property is provided for technical support only.
          It is only returned when retrieving a specific prepared statement, not when retrieving all prepared statements.
      name:
        type: string
        description: |
          The name of the prepared statement.
          This may be a UUID that was assigned automatically, or a name that was user-specified when the statement was created.
      statement:
        type: string
        description: The text of the query.
      uses:
        type: integer
        description: The count of times the prepared statement has been executed.
      avgElapsedTime:
        type: string
        format: duration
        description: |
          The mean time taken from when the request to execute the prepared statement was acknowledged by the service, to when the request was completed.
          It includes the time taken by the service to schedule the request.

          This property is only returned when the prepared statement has been executed.
          It is only returned when retrieving a specific prepared statement, not when retrieving all prepared statements.
      avgServiceTime:
        type: string
        format: duration
        description: |
          The mean amount of calendar time taken to complete the execution of the prepared statement.

          This property is only returned when the prepared statement has been executed.
          It is only returned when retrieving a specific prepared statement, not when retrieving all prepared statements.
      lastUse:
        type: string
        format: date-time
        description: |
          Date and time of last use.

          This property is only returned when the prepared statement has been executed.
      maxElapsedTime:
        type: string
        format: duration
        description: |
          The maximum time taken from when the request to execute the prepared statement was acknowledged by the service, to when the request was completed.
          It includes the time taken by the service to schedule the request.

          This property is only returned when the prepared statement has been executed.
          It is only returned when retrieving a specific prepared statement, not when retrieving all prepared statements.
      maxServiceTime:
        type: string
        format: duration
        description: |
          The maximum amount of calendar time taken to complete the execution of the prepared statement.

          This property is only returned when the prepared statement has been executed.
          It is only returned when retrieving a specific prepared statement, not when retrieving all prepared statements.
      minElapsedTime:
        type: string
        format: duration
        description: |
          The minimum time taken from when the request to execute the prepared statement was acknowledged by the service, to when the request was completed.
          It includes the time taken by the service to schedule the request.

          This property is only returned when the prepared statement has been executed.
          It is only returned when retrieving a specific prepared statement, not when retrieving all prepared statements.
      minServiceTime:
        type: string
        format: duration
        description: |
          The minimum amount of calendar time taken to complete the execution of the prepared statement.

          This property is only returned when the prepared statement has been executed.
          It is only returned when retrieving a specific prepared statement, not when retrieving all prepared statements.

  Vitals:
    type: object
    title: Vital Statistics
    properties:
      uptime:
        type: string
        format: duration
        description: The uptime of the query engine.
      local.time:
        type: string
        format: date-time
        description: The local time of the query engine.
      version:
        type: string
        description: The version of the query engine.
      total.threads:
        type: integer
        description: The number of active threads used by the query engine.
      cores:
        type: integer
        description: The maximum number of logical cores available to the query engine.
      gc.num:
        type: integer
        format: int64
        description: The target heap size of the next garbage collection cycle.
      gc.pause.time:
        type: string
        format: duration
        description: The total time spent pausing for garbage collection since the query engine started (ns).
      gc.pause.percent:
        type: integer
        format: int64
        description: The percentage of time spent pausing for garbage collection since the last time the statistics were checked.
      memory.usage:
        type: integer
        format: int64
        description: |
          The amount of memory allocated for heap objects (bytes).
          This increases as heap objects are allocated, and decreases as objects are freed.
      memory.total:
        type: integer
        format: int64
        description: |
          The cumulative amount of memory allocated for heap objects (bytes).
          This increases as heap objects are allocated, but does not decrease when objects are freed.
      memory.system:
        type: integer
        format: int64
        description: |
          The total amount of memory obtained from the operating system (bytes).
          This measures the virtual address space reserved by the query engine for heaps, stacks, and other internal data structures.
      cpu.user.percent:
        type: integer
        format: int64
        description: |
          CPU usage.
          The percentage of time spent executing user code since the last time the statistics were checked.
      cpu.sys.percent:
        type: integer
        format: int64
        description: |
          CPU usage.
          The percentage of time spent executing system code since the last time the statistics were checked.
      request.completed.count:
        type: integer
        description: Total number of completed requests.
      request.active.count:
        type: integer
        description: Total number of active requests.
      request.per.sec.1min:
        type: number
        description: |
          Number of query requests processed per second.
          1-minute exponentially weighted moving average.
      request.per.sec.5min:
        type: number
        description: |
          Number of query requests processed per second.
          5-minute exponentially weighted moving average.
      request.per.sec.15min:
        type: number
        description: |
          Number of query requests processed per second.
          15-minute exponentially weighted moving average.
      request_time.mean:
        type: string
        format: duration
        description: |
          End-to-end time to process a query.
          The mean value.
      request_time.median:
        type: string
        format: duration
        description: |
          End-to-end time to process a query.
          The median value.
      request_time.80percentile:
        type: string
        format: duration
        description: |
          End-to-end time to process a query.
          The 80th percentile.
      request_time.95percentile:
        type: string
        format: duration
        description: |
          End-to-end time to process a query.
          The 95th percentile.
      request_time.99percentile:
        type: string
        format: duration
        description: |
          End-to-end time to process a query.
          The 99th percentile.
      request.prepared.percent:
        type: integer
        description: Percentage of requests that are prepared statements.

  Statistics:
    type: object
    title: Statistics
    properties:
      active_requests.count:
        type: integer
        description: Total number of active requests.
      at_plus.count:
        type: integer
        description: Total number of query requests with `at_plus` index consistency.
      audit_actions.count:
        type: integer
        description: |
          The total number of audit records sent to the server.
          Some requests cause more than one audit record to be emitted.
          Records in the output queue that have not yet been sent to the server are not counted.
      audit_actions_failed.count:
        type: integer
        description: The total number of audit records sent to the server that failed.
      audit_requests_filtered.count:
        type: integer
        description: The number of potentially auditable requests that cause no audit action to be taken.
      audit_requests_total.count:
        type: integer
        description: The total number of potentially auditable requests sent to the query engine.
      cancelled.count:
        type: integer
        description: Total number of cancelled requests.
      deletes.count:
        type: integer
        description: Total number of DELETE operations.
      errors.count:
        type: integer
        description: The total number of query errors returned so far.
      index_scans.count:
        type: integer
        description: Total number of secondary index scans.
      inserts.count:
        type: integer
        description: Total number of INSERT operations.
      invalid_requests.count:
        type: integer
        description: Total number of requests for unsupported endpoints.
      mutations.count:
        type: integer
        description: Total number of document mutations.
      prepared.count:
        type: integer
        description: Total number of prepared statements executed.
      primary_scans.count:
        type: integer
        description: Total number of primary index scans.
      queued_requests.count:
        type: integer
        description: Total number of queued requests.
      request_time.count:
        type: integer
        description: Total end-to-end time to process all queries (ns).
      request_timer.15m.rate:
        type: number
        description: |
          Number of query requests processed per second.
          15-minute exponentially weighted moving average.
      request_timer.1m.rate:
        type: number
        description: |
          Number of query requests processed per second.
          1-minute exponentially weighted moving average.
      request_timer.5m.rate:
        type: number
        description: |
          Number of query requests processed per second.
          5-minute exponentially weighted moving average.
      request_timer.75%:
        type: number
        description: |
          End-to-end time to process a query (ns).
          The 75th percentile.
      request_timer.95%:
        type: number
        description: |
          End-to-end time to process a query (ns).
          The 95th percentile.
      request_timer.99%:
        type: number
        description: |
          End-to-end time to process a query (ns).
          The 99th percentile.
      request_timer.99.9%:
        type: number
        description: |
          End-to-end time to process a query (ns).
          The 99.9th percentile.
      request_timer.count:
        type: integer
        description: Total number of query requests.
      request_timer.max:
        type: integer
        description: |
          End-to-end time to process a query (ns).
          The maximum value.
      request_timer.mean:
        type: number
        description: |
          End-to-end time to process a query (ns).
          The mean value.
      request_timer.mean.rate:
        type: number
        description: |
          Number of query requests processed per second.
          Mean rate since the query service started.
      request_timer.median:
        type: number
        description: |
          End-to-end time to process a query (ns).
          The median value.
      request_timer.min:
        type: integer
        description: |
          End-to-end time to process a query (ns).
          The minimum value.
      request_timer.stddev:
        type: number
        description: |
          End-to-end time to process a query (ns).
          The standard deviation.
      requests.count:
        type: integer
        description: Total number of query requests.
      requests_1000ms.count:
        type: integer
        description: Number of queries that take longer than 1000ms.
      requests_250ms.count:
        type: integer
        description: Number of queries that take longer than 250ms.
      requests_5000ms.count:
        type: integer
        description: Number of queries that take longer than 5000ms.
      requests_500ms.count:
        type: integer
        description: Number of queries that take longer than 500ms.
      result_count.count:
        type: integer
        description: Total number of results (documents) returned by the query engine.
      result_size.count:
        type: integer
        description: Total size of data returned by the query engine (bytes).
      scan_plus.count:
        type: integer
        description: Total number of query requests with `request_plus` index consistency.
      selects.count:
        type: integer
        description: Total number of SELECT requests.
      service_time.count:
        type: integer
        description: Time to execute all queries (ns).
      unbounded.count:
        type: integer
        description: Total number of query requests with `not_bounded` index consistency.
      updates.count:
        type: integer
        description: Total number of UPDATE requests.
      warnings.count:
        type: integer
        description: The total number of query warnings returned so far.

  Metrics:
    type: object
    title: Metrics
    properties:
      count:
        type: integer
        description: A single value that represents the current state.
      15m.rate:
        type: number
        description: 15-minute exponentially weighted moving average.
      1m.rate:
        type: number
        description: 1-minute exponentially weighted moving average.
      5m.rate:
        type: number
        description: 5-minute exponentially weighted moving average.
      mean.rate:
        type: number
        description: Mean rate since the query service started.
      max:
        type: integer
        description: The maximum value.
      mean:
        type: number
        description: The mean value.
      median:
        type: number
        description: The median value.
      min:
        type: integer
        description: The minimum value.
      stddev:
        type: number
        description: The standard deviation.
      75%:
        type: number
        description: The 75th percentile.
      95%:
        type: number
        description: The 95th percentile.
      99%:
        type: number
        description: The 99th percentile.
      99.9%:
        type: number
        description: The 99.9th percentile.

  Settings:
    type: object
    title: Settings
    properties:
      atrcollection:
        type: string
        default: ""
        example: pass:c[default:`travel-sample`.transaction.test]
        description: |
          [[atrcollection-srv]]
          Specifies the collection where xref:learn:data/transactions.adoc#additional-storage-use[active transaction records] are stored.
          The collection must be present.
          If not specified, the active transaction record is stored in the default collection in the default scope in the bucket containing the first mutated document within the transaction.

          The value must be a string in the form `"bucket.scope.collection"` or `"namespace:bucket.scope.collection"`.
          If any part of the path contains a special character, that part of the path must be delimited in backticks `pass:c[``]`.

          The {atrcollection_req}[request-level] `atrcollection` parameter specifies this property per request.
          If a request does not include this parameter, the node-level `atrcollection` setting will be used.
      auto-prepare:
        type: boolean
        default: false
        example: true
        description: |
          [[auto-prepare]]
          Specifies whether the query engine should create a prepared statement every time a N1QL request is submitted, whether the PREPARE statement is included or not.
          
          Refer to xref:n1ql:n1ql-language-reference/prepare.adoc#auto-prepare[Auto-Prepare] for more information.

      cleanupclientattempts:
        type: boolean
        default: true
        example: false
        description: |
          [[cleanupclientattempts]]
          When enabled, the Query service preferentially aims to clean up just transactions that it has created, leaving transactions for the distributed cleanup process only when it is forced to.

          The {queryCleanupClientAttempts}[cluster-level] `queryCleanupClientAttempts` setting specifies this property for the whole cluster.
          When you change the cluster-level setting, the node-level setting is over-written for all nodes in the cluster.
      cleanuplostattempts:
        type: boolean
        default: true
        example: false
        description: |
          [[cleanuplostattempts]]
          When enabled, the Query service takes part in the distributed cleanup process, and cleans up expired transactions created by any client.

          The {queryCleanupLostAttempts}[cluster-level] `queryCleanupLostAttempts` setting specifies this property for the whole cluster.
          When you change the cluster-level setting, the node-level setting is over-written for all nodes in the cluster.
      cleanupwindow:
        type: string
        format: duration
        default: 60s
        example: 30s
        description: |
          [[cleanupwindow]]
          Specifies how frequently the Query service checks its subset of xref:learn:data/transactions.adoc#additional-storage-use[active transaction records] for cleanup.
          Decreasing this setting causes expiration transactions to be found more swiftly, with the tradeoff of increasing the number of reads per second used for the scanning process.

          The value for this setting is a string.
          Its format includes an amount and a mandatory unit, e.g. `10ms` (10 milliseconds) or `0.5s` (half a second).
          Valid units are:

          * `ns` (nanoseconds)
          * `us` (microseconds)
          * `ms` (milliseconds)
          * `s` (seconds)
          * `m` (minutes)
          * `h` (hours)

          The {queryCleanupWindow}[cluster-level] `queryCleanupWindow` setting specifies this property for the whole cluster.
          When you change the cluster-level setting, the node-level setting is over-written for all nodes in the cluster.
      completed:
        type: object
        title: Logging parameters
        default: {"aborted": null, "threshold": 1000}
        example: {"user": "marco", "error": 12003}
        description: |
          [[completed]]
          A nested object that sets the parameters for the completed requests catalog.
          All completed requests that match these parameters are tracked in the completed requests catalog.

          Refer to xref:manage:monitor/monitoring-n1ql-query.adoc#sys-completed-config[Configure the Completed Requests] for more information and examples.
        properties:
          aborted:
            type: boolean
            default: null
            example: true
            description: If true, all requests that generate a panic are logged.
          client:
            type: string
            default: ""
            example: "172.1.2.3"
            description: |
              The IP address of the client.
              If specified, all completed requests from this IP address are logged.
          context:
            type: string
            description: |
              The opaque ID or context provided by the client.
              If specified, all completed requests with this client context ID are logged.
              
              Refer to the {client_context_id}[request-level] `client_context_id` parameter for more information.
          error:
            type: integer
            format: int32
            default: null
            example: 12003
            description: |
              An error number.
              If specified, all completed queries returning this error number are logged.
          tag:
            type: string
            default: ""
            example: "both_user_and_error"
            description: |
              A unique string which tags a set of qualifiers.

              Refer to xref:manage:monitor/monitoring-n1ql-query.adoc#sys-completed-config[Configure the Completed Requests] for more information.
          threshold:
            type: integer
            format: int32
            default: 1000
            example: 7000
            description: |
              A duration in milliseconds.
              If specified, all completed queries lasting longer than this threshold are logged.

              This is another way of specifying the {completed-threshold-srv}[node-level] `completed-threshold` setting.
          user: 
            type: string
            default: ""
            example: "marco"
            description: |
              A user name, as given in the request credentials.
              If specified, all completed queries with this user name are logged.
      completed-limit:
        type: integer
        format: int32
        default: 4000
        example: 7000
        description: |
          [[completed-limit]]
          Sets the number of requests to be logged in the completed requests catalog.
          As new completed requests are added, old ones are removed.

          Increase this when the completed request keyspace is not big enough to track the slow requests, such as when you want a larger sample of slow requests.

          Refer to xref:manage:monitor/monitoring-n1ql-query.adoc#sys-completed-config[Configure the Completed Requests] for more information and examples.

          The {queryCompletedLimit}[cluster-level] `queryCompletedLimit` setting specifies this property for the whole cluster.
          When you change the cluster-level setting, the node-level setting is over-written for all nodes in the cluster.
      completed-threshold:
        type: integer
        format: int32
        default: 1000
        example: 7000
        description: |
          [[completed-threshold]]
          A duration in milliseconds.
          All completed queries lasting longer than this threshold are logged in the completed requests catalog.

          Specify `0` to track all requests, independent of duration.
          Specify any negative number to track none.

          Refer to xref:manage:monitor/monitoring-n1ql-query.adoc#sys-completed-config[Configure the Completed Requests] for more information and examples.

          The {queryCompletedThreshold}[cluster-level] `queryCompletedThreshold` setting specifies this property for the whole cluster.
          When you change the cluster-level setting, the node-level setting is over-written for all nodes in the cluster.
      controls:
        type: boolean
        default: false
        example: true
        description: |
          [[controls-srv]]
          Specifies if there should be a controls section returned with the request results.

          When set to `true`, the query response document includes a controls section with runtime information provided along with the request, such as positional and named parameters or settings.

          [NOTE]
          If the request qualifies for caching, these values will also be cached in the `completed_requests` system keyspace.

          The {controls_req}[request-level] `controls` parameter specifies this property per request.
          If a request does not include this parameter, the node-level `controls` setting will be used.
      cpuprofile:
        type: string
        default: ""
        example: /tmp/info.txt
        description: |
          [[cpuprofile]]
          The absolute path and filename to write the CPU profile to a local file.

          The output file includes a controls section and performance measurements, such as memory allocation and garbage collection, to pinpoint bottlenecks and ways to improve your code execution.

          To stop `cpuprofile`, run with the empty setting of `""`.

          [NOTE]
          If `cpuprofile` is left running too long, it can slow the system down as its file size increases.

          //
      debug:
        type: boolean
        default: false
        example: true
        description: |
          [[debug]]
          Use debug mode.

          When set to `true`, extra logging is provided.
      distribute:
        type: boolean
        example: true
        description: |
          [[distribute]]
          This field is only available with the POST method.
          When specified alongside other settings, this field instructs the node that is processing the request to cascade those settings to all other query nodes.
          The actual value of this field is ignored.
      functions-limit:
        type: integer
        format: int32
        default: 16384
        example: 7000
        description: |
          [[functions-limit]]
          Maximum number of user-defined functions.
      keep-alive-length:
        type: integer
        format: int32
        default: 16384
        example: 7000
        description: |
          [[keep-alive-length]]
          Maximum size of buffered result.
      loglevel:
        type: string
        default: INFO
        enum: ["DEBUG","TRACE","INFO","WARN","ERROR","SEVERE","NONE"]
        example: DEBUG
        description: |
          [[loglevel]]
          Log level used in the logger.

          All values, in descending order of data:{blank}

          `DEBUG` -- For developers.
          Writes everything.

          `TRACE` -- For developers.
          Less info than `DEBUG`.

          `INFO` -- For admin & customers.
          Lists warnings & errors.

          `WARN` -- For admin.
          Only abnormal items.

          `ERROR` -- For admin.
          Only errors to be fixed.

          `SEVERE` -- For admin.
          Major items, like crashes.

          `NONE` -- Doesn’t write anything.

          The {queryLogLevel}[cluster-level] `queryLogLevel` setting specifies this property for the whole cluster.
          When you change the cluster-level setting, the node-level setting is over-written for all nodes in the cluster.
      max-index-api:
        type: integer
        format: int32
        description: |
          [[max-index-api]]
          Max index API.
          This setting is provided for technical support only.
      max-parallelism:
        type: integer
        format: int32
        default: 1
        example: 0
        description: |
          [[max-parallelism-srv]]
          Specifies the maximum parallelism for queries on this node.

          If the value is zero or negative, the maximum parallelism is restricted to the number of allowed cores.
          Similarly, if the value is greater than the number of allowed cores, the maximum parallelism is restricted to the number of allowed cores.

          (The number of allowed cores is the same as the number of logical CPUs.
          In Community Edition, the number of allowed cores cannot be greater than 4.
          In Enterprise Edition, there is no limit to the number of allowed cores.)

          The {queryMaxParallelism}[cluster-level] `queryMaxParallelism` setting specifies this property for the whole cluster.
          When you change the cluster-level setting, the node-level setting is over-written for all nodes in the cluster.

          In addition, there is a {max_parallelism_req}[request-level] `max_parallelism` parameter.
          If a request includes this parameter, it will be capped by the node-level `max-parallelism` setting.

          [NOTE]
          To enable queries to run in parallel, you must specify the cluster-level `queryMaxParallelism` parameter, or specify the node-level `max-parallelism` parameter on all Query nodes.

          Refer to xref:n1ql:n1ql-language-reference/index-partitioning.adoc#max-parallelism[Max Parallelism] for more information.
      memory-quota:
        type: integer
        format: int32
        default: 0
        example: 4
        description: |
          [[memory-quota-srv]]
          Specifies the maximum amount of memory a request may use on this node, in MB.
          Note that the overall node memory quota is this setting multiplied by the <<servicers,node-level>> `servicers` setting.

          Specify `0` (the default value) to disable.
          When disabled, there is no quota.

          Within a transaction, this setting enforces the memory quota for the transaction.
          The transaction memory quota tracks only the delta table and the transaction log (approximately).

          The {queryMemoryQuota}[cluster-level] `queryMemoryQuota` setting specifies this property for the whole cluster.
          When you change the cluster-level setting, the node-level setting is over-written for all nodes in the cluster.

          In addition, the {memory_quota_req}[request-level] `memory_quota` parameter specifies this property per request.
          If a request includes this parameter, it will be capped by the node-level `memory-quota` setting.
      memprofile:
        type: string
        default: ""
        example: /tmp/memory-usage.log
        description: |
          [[memprofile]]
          Filename to write the diagnostic memory usage log.

          To stop `memprofile`, run with the empty setting of `""`.

          [NOTE]
          If `memprofile` is left running too long, it can slow the system down as its file size increases.

          //
      mutexprofile:
        type: boolean
        default: false
        description: |
          [[mutexprofile]]
          Mutex profile.
          This setting is provided for technical support only.
      numatrs:
        type: string
        description: |
          [[numatrs-srv]]
          Specifies the total number of xref:learn:data/transactions.adoc#additional-storage-use[active transaction records].

          The {queryNumAtrs}[cluster-level] `queryNumAtrs` setting specifies this property for the whole cluster.
          When you change the cluster-level setting, the node-level setting is over-written for all nodes in the cluster.

          In addition, the {numatrs_req}[request-level] `numatrs` parameter specifies this property per request.
          The minimum of that and the node-level `numatrs` setting is applied.
      n1ql-feat-ctrl:
        type: integer
        format: int32
        default: 76
        description: |
          [[n1ql-feat-ctrl]]
          {sqlpp} feature control.
          This setting is provided for technical support only.

          The {queryN1qlFeatCtrl}[cluster-level] `queryN1qlFeatCtrl` setting specifies this property for the whole cluster.
          When you change the cluster-level setting, the node-level setting is over-written for all nodes in the cluster.
      pipeline-batch:
        type: integer
        format: int32
        default: 16
        example: 64
        description: |
          [[pipeline-batch-srv]]
          Controls the number of items execution operators can batch for Fetch from the KV.

          The {queryPipelineBatch}[cluster-level] `queryPipelineBatch` setting specifies this property for the whole cluster.
          When you change the cluster-level setting, the node-level setting is over-written for all nodes in the cluster.

          In addition, the {pipeline_batch_req}[request-level] `pipeline_batch` parameter specifies this property per request.
          The minimum of that and the node-level `pipeline-batch` setting is applied.
      pipeline-cap:
        type: integer
        format: int32
        default: 512
        example: 1024
        description: |
          [[pipeline-cap-srv]]
          Maximum number of items each execution operator can buffer between various operators.

          The {queryPipelineCap}[cluster-level] `queryPipelineCap` setting specifies this property for the whole cluster.
          When you change the cluster-level setting, the node-level setting is over-written for all nodes in the cluster.

          In addition, the {pipeline_cap_req}[request-level] `pipeline_cap` parameter specifies this property per request.
          The minimum of that and the node-level `pipeline-cap` setting is applied.
      plus-servicers:
        type: integer
        format: int32
        example: 16
        description: |
          [[plus-servicers]]
          The number of service threads for transactions where the scan consistency is `request_plus` or `at_plus`.
          The default is 16 times the number of logical cores.
      prepared-limit:
        type: integer
        format: int32
        default: 16384
        example: 65536
        description: |
          [[prepared-limit]]
          Maximum number of prepared statements in the cache.
          When this cache reaches the limit, the least recently used prepared statements will be discarded as new prepared statements are created.

          The {queryPreparedLimit}[cluster-level] `queryPreparedLimit` setting specifies this property for the whole cluster.
          When you change the cluster-level setting, the node-level setting is over-written for all nodes in the cluster.
      pretty:
        type: boolean
        default: false
        example: true
        description: |
          [[pretty-srv]]
          Specifies whether query results are returned in pretty format.

          The {pretty_req}[request-level] `pretty` parameter specifies this property per request.
          If a request does not include this parameter, the node-level setting is used, which defaults to `false`.
      profile:
        type: string
        default: "off"
        example: "phases"
        enum: ["off","phases","timings"]
        description: |
          [[profile-srv]]
          Specifies if there should be a profile section returned with the request results.
          The valid values are:{blank}

          `off` -- No profiling information is added to the query response.

          `phases` -- The query response includes a profile section with stats and details about various phases of the query plan and execution.
          Three phase times will be included in the `system:active_requests` and `system:completed_requests` monitoring keyspaces.

          `timings` -- Besides the phase times, the profile section of the query response document will include a full query plan with timing and information about the number of processed documents at each phase.
          This information will be included in the `system:active_requests` and `system:completed_requests` keyspaces.

          [NOTE]
          If `profile` is not set as one of the above values, then the profile setting does not change.
          
          Refer to xref:manage:monitor/monitoring-n1ql-query.adoc#monitor-profile-details[Monitoring and Profiling Details] for more information and examples.

          The {profile_req}[request-level] `profile` parameter specifies this property per request.
          If a request does not include this parameter, the node-level `profile` setting will be used.
      request-size-cap:
        type: integer
        format: int32
        default: 67108864
        example: 70000
        description: |
          [[request-size-cap]]
          Maximum size of a request.
      scan-cap:
        type: integer
        format: int32
        default: 512
        example: 1024
        description: |
          [[scan-cap-srv]]
          Maximum buffered channel size between the indexer client and the query service for index scans.
          This parameter controls when to use scan backfill.

          Use `0` or a negative number to disable.
          Smaller values reduce GC, while larger values reduce indexer backfill.

          The {queryScanCap}[cluster-level] `queryScanCap` setting specifies this property for the whole cluster.
          When you change the cluster-level setting, the node-level setting is over-written for all nodes in the cluster.

          In addition, the {scan_cap_req}[request-level] `scan_cap` parameter specifies this property per request.
          The minimum of that and the node-level `scan-cap` setting is applied.
      servicers:
        type: integer
        format: int32
        default: 32
        example: 8
        description: |
          [[servicers]]
          The number of service threads for the query.
          The default is 4 times the number of cores on the query node.

          Note that the overall node memory quota is this setting multiplied by the <<memory-quota-srv,node-level>> `memory-quota` setting.
      timeout:
        type: integer
        format: int64
        default: 0
        example: 500000000
        description: |
          [[timeout-srv]]
          Maximum time to spend on the request before timing out (ns).

          The value for this setting is an integer, representing a duration in nanoseconds.
          It must not be delimited by quotes, and must not include a unit.

          Specify `0` (the default value) or a negative integer to disable.
          When disabled, no timeout is applied and the request runs for however long it takes.

          The {queryTimeout}[cluster-level] `queryTimeout` setting specifies this property for the whole cluster.
          When you change the cluster-level setting, the node-level setting is over-written for all nodes in the cluster.

          In addition, the {timeout_req}[request-level] `timeout` parameter specifies this property per request.
          The minimum of that and the node-level `timeout` setting is applied.
      txtimeout:
        type: integer
        format: int64
        default: 0
        example: 500000000
        description: |
          [[txtimeout-srv]]
          Maximum time to spend on a transaction before timing out (ns).
          This setting only applies to requests containing the `BEGIN TRANSACTION` statement, or to requests where the {tximplicit}[tximplicit] parameter is set.
          For all other requests, it is ignored.

          The value for this setting is an integer, representing a duration in nanoseconds.
          It must not be delimited by quotes, and must not include a unit.

          Specify `0` (the default value) to disable.
          When disabled, no timeout is applied and the transaction runs for however long it takes.

          The {queryTxTimeout}[cluster-level] `queryTxTimeout` setting specifies this property for the whole cluster.
          When you change the cluster-level setting, the node-level setting is over-written for all nodes in the cluster.

          In addition, the {txtimeout_req}[request-level] `txtimeout` parameter specifies this property per request.
          The minimum of that and the node-level `txtimeout` setting is applied.
      use-cbo:
        type: boolean
        default: true
        example: false
        description: |
          [[use-cbo-srv]]
          Specifies whether the cost-based optimizer is enabled.

          The {queryUseCBO}[cluster-level] `queryUseCBO` setting specifies this property for the whole cluster.
          When you change the cluster-level setting, the node-level setting is over-written for all nodes in the cluster.

          In addition, the {use_cbo_req}[request-level] `use_cbo` parameter specifies this property per request.
          If a request does not include this parameter, the node-level setting is used, which defaults to `true`.

parameters:
  PathStat:
    name: stat
    in: path
    type: string
    required: true
    enum:
      - active_requests
      - at_plus
      - audit_actions
      - audit_actions_failed
      - audit_requests_filtered
      - audit_requests_total
      - cancelled
      - deletes
      - errors
      - index_scans
      - inserts
      - invalid_requests
      - mutations
      - prepared
      - primary_scans
      - queued_requests
      - request_time
      - request_timer
      - requests
      - requests_1000ms
      - requests_250ms
      - requests_5000ms
      - requests_500ms
      - result_count
      - result_size
      - scan_plus
      - selects
      - service_time
      - unbounded
      - updates
      - warnings
    description: |
      The name of a statistic.
      Only top-level statistic names can be used.
      You cannot specify a metric.

  PathName:
    name: name
    type: string
    in: path
    required: true
    description: |
      The name of a prepared statement.
      This may be a UUID that was assigned automatically, or a name that was user-specified when the statement was created.

  PathRequest:
    name: request
    type: string
    in: path
    required: true
    description: |
      The name of a request.
      This is the `requestID` that was assigned automatically when the statement was created.

  PathCluster:
    name: cluster
    type: string
    in: path
    required: true
    description: The name of a cluster.

  PathNode:
    name: node
    type: string
    in: path
    required: true
    description: The name of a node.

securityDefinitions:
  Default:
    type: basic
    description: |
      The Admin API supports admin credentials.
      Credentials can be passed via HTTP headers (HTTP basic authentication).

  None:
    type: basic
    description: No authentication is required for the <<_get_ping>> or <<_get_debug_vars>> endpoints.
